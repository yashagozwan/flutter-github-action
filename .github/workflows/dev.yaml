name: Flutter Integration Test

on: push

jobs:
  integration_test:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout code
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Set up Flutter
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: stable

      # 3. Install dependencies
      - name: Install dependencies
        run: flutter pub get

      # 4. Enable integration test device
      - name: Set up virtual display for integration tests
        run: |
          sudo apt-get update
          sudo apt-get install -y xvfb
          Xvfb :99 -screen 0 640x480x24 &

      # 5. Run integration tests
      - name: Run integration tests
        env:
          DISPLAY: :99
        run: |
          flutter test integration_test/home_test.dart
